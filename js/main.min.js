const columnOrder=["SKU","NAMA","Grand Total","A12 - 1","A12 - 2","A12 - 3","A12 - 4","A19 - 1","A19 - 2","A19 - 3","A20 - 1","A20 - 3","LTC"],lantaiColumns=columnOrder.slice(3);let data=[],tab="all",batchSize=100,renderedRows=0,currentSort={column:null,asc:!0};function changeTheme(e){document.body.className=e,localStorage.setItem("selectedTheme",e)}function loadSavedTheme(){let e=localStorage.getItem("selectedTheme");if(e){document.body.className=e;let t=document.getElementById("themeSelector");t&&(t.value=e)}}function setTab(e){tab=e,document.getElementById("tabAll").classList.remove("active"),document.getElementById("tabMinus").classList.remove("active"),document.getElementById("tab"+capitalize(e)).classList.add("active"),renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function getSelectedFloors(){return JSON.parse(localStorage.getItem("selectedFloors")||JSON.stringify(lantaiColumns))}function saveSelectedFloors(e){localStorage.setItem("selectedFloors",JSON.stringify(e)),renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}function setupLantaiCheckboxes(){let e=document.getElementById("lantaiFilter");e.innerHTML="",lantaiColumns.forEach(t=>{let a=document.createElement("label"),l=document.createElement("input");l.type="checkbox",l.value=t,l.checked=getSelectedFloors().includes(t),l.onchange=()=>{let e=Array.from(document.querySelectorAll("#lantaiFilter input:checked")).map(e=>e.value);saveSelectedFloors(e)},a.appendChild(l),a.append(" ",t),e.appendChild(a)})}function selectAllFloors(){let e=document.querySelectorAll("#lantaiFilter input[type='checkbox']");e.forEach(e=>e.checked=!0);let t=Array.from(e).map(e=>e.value);saveSelectedFloors(t)}function clearAllFloors(){let e=document.querySelectorAll("#lantaiFilter input[type='checkbox']");e.forEach(e=>e.checked=!1),saveSelectedFloors([])}function initResize(e){return function(t){let a=document.querySelectorAll("th")[e],l=t.pageX,n=a.offsetWidth;function r(e){let t=n+(e.pageX-l);a.style.width=t+"px"}function o(){document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",o)}document.addEventListener("mousemove",r),document.addEventListener("mouseup",o)}}function sortTable(e){currentSort.asc=currentSort.column!==e||!currentSort.asc,currentSort.column=e,data.sort((t,a)=>{let l=t[e]??"",n=a[e]??"";return currentSort.asc?l.toString().localeCompare(n.toString(),void 0,{numeric:!0}):n.toString().localeCompare(l.toString(),void 0,{numeric:!0})}),renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}function renderTable(){let e=document.getElementById("searchInput").value.toLowerCase(),t=getSelectedFloors(),a=["SKU","NAMA","Grand Total",...t],l=document.querySelector("#data-table thead"),n=document.querySelector("#data-table tbody");l.innerHTML="";let r=document.createElement("tr");a.forEach((e,t)=>{let a=document.createElement("th");a.textContent=e,a.onclick=()=>sortTable(e),currentSort.column===e&&a.classList.add(currentSort.asc?"sort-asc":"sort-desc");let l=document.createElement("div");l.classList.add("resizer"),l.addEventListener("mousedown",initResize(t)),a.appendChild(l),r.appendChild(a)}),l.appendChild(r);let o=data.filter(a=>{let l=`${a.SKU??""} ${a.NAMA??""}`.toLowerCase(),n=l.includes(e),r="minus"!==tab||t.some(e=>0>Number(a[e]))||0>Number(a["Grand Total"]);return n&&r}),c=document.createDocumentFragment(),s=o.slice(renderedRows,renderedRows+batchSize);s.forEach(e=>{let t=document.createElement("tr");a.forEach(a=>{let l=document.createElement("td"),n=e[a];(void 0===n||""===n)&&(n="-"),l.textContent=n,!isNaN(n)&&0>Number(n)&&l.classList.add("highlight-minus"),t.appendChild(l)}),c.appendChild(t)}),n.appendChild(c),renderedRows+=batchSize}function refreshTable(){renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}function onSearchInput(){let e=document.getElementById("searchInput"),t=document.querySelector(".clear-button");""!==e.value.trim()?t.classList.add("show"):t.classList.remove("show"),refreshTable()}function clearSearch(){let e=document.getElementById("searchInput");e.value="",onSearchInput()}async function fetchData(){document.getElementById("spinner").style.display="inline-block";let[e,t]=await Promise.all([fetch("https://pernataan-db-default-rtdb.asia-southeast1.firebasedatabase.app/rekap.json"),fetch("https://pernataan-db-default-rtdb.asia-southeast1.firebasedatabase.app/sku_master.json")]),a=await e.json(),l=await t.json(),n=a||{};data=Object.values(l||{}).map(e=>({...e,...n[e.SKU]||{}})),setupLantaiCheckboxes(),document.querySelector("#data-table thead").innerHTML="",document.querySelector("#data-table tbody").innerHTML="",renderedRows=0,renderTable(),document.getElementById("lastUpdated").textContent=new Date().toLocaleTimeString("id-ID"),document.getElementById("spinner").style.display="none"}document.getElementById("tableWrapper").addEventListener("scroll",()=>{let e=document.getElementById("tableWrapper");e.scrollTop+e.clientHeight>=e.scrollHeight-10&&renderTable()}),document.getElementById("toggleFilterBtn").addEventListener("click",function(){let e=document.querySelector(".filter-wrapper"),t=document.getElementById("toggleFilterBtn"),a=e.classList.toggle("show");t.textContent=(a?"\uD83D\uDD3C":"\uD83D\uDD3D")+" Filter"}),document.getElementById("lastUpdated").addEventListener("click",function(){let e=document.getElementById("easterAudio");e.currentTime=0,e.play()}),loadSavedTheme(),fetchData(),setInterval(fetchData,6e4);