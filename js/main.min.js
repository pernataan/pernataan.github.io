const columnOrder=["SKU","Nama","Total","A12 - 1","A12 - 2","A12 - 3","A12 - 4","A19 - 1","A19 - 2","A19 - 3","A20 - 1","A20 - 2","A20 - 3","A20 - 4","LTC"],lantaiColumns=columnOrder.slice(3);let data=[],tab="all",batchSize=100,renderedRows=0,currentSort={column:null,asc:!0};function changeTheme(e){document.body.className=e,localStorage.setItem("selectedTheme",e)}function loadSavedTheme(){const e=localStorage.getItem("selectedTheme");if(e){document.body.className=e;const t=document.getElementById("themeSelector");t&&(t.value=e)}}function formatCurrency(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e)}function setTab(e){tab=e,document.getElementById("tabAll").classList.remove("active"),document.getElementById("tabMinus").classList.remove("active"),document.getElementById("tab"+capitalize(e)).classList.add("active"),renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}function debounce(e,t){let n;return function(...o){clearTimeout(n),n=setTimeout((()=>e.apply(this,o)),t)}}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function getSelectedFloors(){return JSON.parse(localStorage.getItem("selectedFloors")||JSON.stringify(lantaiColumns))}function saveSelectedFloors(e){localStorage.setItem("selectedFloors",JSON.stringify(e)),renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}function setupLantaiCheckboxes(){const e=document.getElementById("lantaiFilter");e.innerHTML="",lantaiColumns.forEach((t=>{const n=document.createElement("label"),o=document.createElement("input");o.type="checkbox",o.value=t;const r=getSelectedFloors();o.checked=r.includes(t),o.onchange=()=>{saveSelectedFloors(Array.from(document.querySelectorAll("#lantaiFilter input:checked")).map((e=>e.value)))},n.appendChild(o),n.append(" ",t),e.appendChild(n)}))}function selectAllFloors(){const e=document.querySelectorAll("#lantaiFilter input[type='checkbox']");e.forEach((e=>e.checked=!0));saveSelectedFloors(Array.from(e).map((e=>e.value)))}function clearAllFloors(){document.querySelectorAll("#lantaiFilter input[type='checkbox']").forEach((e=>e.checked=!1)),saveSelectedFloors([])}function initResize(e){return function(t){const n=document.querySelectorAll("th")[e],o=t.pageX,r=n.offsetWidth;function c(e){const t=r+(e.pageX-o);n.style.width=t+"px"}document.addEventListener("mousemove",c),document.addEventListener("mouseup",(function e(){document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",e)}))}}function renderTable(){const e=document.getElementById("searchInput").value.toLowerCase().trim(),t=getSelectedFloors(),n=["SKU","Nama","Total",...t],o=document.querySelector("#data-table thead"),r=document.querySelector("#data-table tbody");o.innerHTML="";const c=document.createElement("tr");n.forEach(((e,t)=>{const n=document.createElement("th");n.textContent=e,n.onclick=()=>sortTable(e),currentSort.column===e&&n.classList.add(currentSort.asc?"sort-asc":"sort-desc");const o=document.createElement("div");o.classList.add("resizer"),o.addEventListener("mousedown",initResize(t)),n.appendChild(o),c.appendChild(n)})),o.appendChild(c);let a=data.filter((n=>{const o=`${n.SKU??""} ${n.Nama??""}`.toLowerCase(),r=e.trim().split(/\s+/).every((e=>o.includes(e))),c="minus"!==tab||t.some((e=>Number(n[e])<0))||Number(n.Total)<0;return r&&c}));const l=document.createDocumentFragment();a.slice(renderedRows,renderedRows+batchSize).forEach((e=>{const t=document.createElement("tr");n.forEach((n=>{const o=document.createElement("td");let r=e[n];void 0!==r&&""!==r||(r="-"),o.textContent=r,!isNaN(r)&&Number(r)<0&&o.classList.add("highlight-minus"),t.appendChild(o)})),l.appendChild(t)})),r.appendChild(l),renderedRows+=batchSize}function sortTable(e){currentSort.asc=currentSort.column!==e||!currentSort.asc,currentSort.column=e,data.sort(((t,n)=>{let o=t[e]??"",r=n[e]??"";return currentSort.asc?o.toString().localeCompare(r.toString(),void 0,{numeric:!0}):r.toString().localeCompare(o.toString(),void 0,{numeric:!0})})),renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}function refreshTable(){renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}"serviceWorker"in navigator&&navigator.serviceWorker.register("service-worker.js").then((e=>console.log("✅ Service Worker registered:",e.scope))).catch((e=>console.error("⚠️ Service Worker failed:",e)));const debouncedRefreshTable=debounce(refreshTable,250);function onSearchInput(){const e=document.getElementById("searchInput"),t=document.querySelector(".clear-button");""!==e.value.trim()?t.classList.add("show"):t.classList.remove("show"),debouncedRefreshTable()}function clearSearch(){document.getElementById("searchInput").value="",onSearchInput()}async function fetchData(){document.getElementById("spinner").style.display="inline-block";const e=await fetch("https://pusatpneumatic.com/pernataan/scripts/stok.json"),t=await e.json();data=(t||[]).map((e=>{const t={SKU:e.s,Nama:e.n,Harga:e.p,Total:e.t};return e.k.forEach((e=>{t[e.l]=e.q})),t})),setupLantaiCheckboxes(),document.querySelector("#data-table thead").innerHTML="",document.querySelector("#data-table tbody").innerHTML="",renderedRows=0,renderTable(),document.getElementById("lastUpdated").textContent=(new Date).toLocaleTimeString("id-ID"),document.getElementById("spinner").style.display="none"}document.getElementById("tableWrapper").addEventListener("scroll",(()=>{const e=document.getElementById("tableWrapper");e.scrollTop+e.clientHeight>=e.scrollHeight-10&&renderTable()})),document.getElementById("toggleFilterBtn").addEventListener("click",(function(){const e=document.querySelector(".filter-wrapper"),t=document.getElementById("toggleFilterBtn"),n=e.classList.toggle("show");t.textContent=(n?"🔼":"🔽")+" Filter"})),document.getElementById("lastUpdated").addEventListener("click",(function(){const e=document.getElementById("easterAudio");e.currentTime=0,e.play()})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("tableWrapper"),t=document.getElementById("rocketmeluncur");let n=!1;e.addEventListener("scroll",(()=>{n||(e.scrollTop>200?t.classList.add("showrocket"):t.classList.remove("showrocket"))})),t.addEventListener("click",(()=>{t.classList.add("launchrocket"),n=!0,e.scrollTo({top:0,behavior:"smooth"}),setTimeout((()=>{t.classList.remove("launchrocket"),t.classList.remove("showrocket"),n=!1}),800)}))})),loadSavedTheme(),fetchData(),setInterval(fetchData,6e4);