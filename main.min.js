const columnOrder=["SKU","NAMA","A12 - 1","A12 - 2","A12 - 3","A12 - 4","A19 - 1","A19 - 2","A19 - 3","A20 - 1","A20 - 3","LTC","Grand Total"],lantaiColumns=columnOrder.slice(2,-1);let data=[],tab="all",batchSize=100,renderedRows=0,currentSort={column:null,asc:!0};function changeTheme(e){document.body.className=e,localStorage.setItem("selectedTheme",e)}function loadSavedTheme(){let e=localStorage.getItem("selectedTheme");if(e){document.body.className=e;let t=document.getElementById("themeSelector");t&&(t.value=e)}}function setTab(e){tab=e,document.getElementById("tabAll").classList.remove("active"),document.getElementById("tabMinus").classList.remove("active"),document.getElementById("tab"+capitalize(e)).classList.add("active"),renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function getSelectedFloors(){return JSON.parse(localStorage.getItem("selectedFloors")||JSON.stringify(lantaiColumns))}function saveSelectedFloors(e){localStorage.setItem("selectedFloors",JSON.stringify(e)),renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}function setupLantaiCheckboxes(){let e=document.getElementById("lantaiFilter");e.innerHTML="",lantaiColumns.forEach(t=>{let a=document.createElement("label"),n=document.createElement("input");n.type="checkbox",n.value=t,n.checked=getSelectedFloors().includes(t),n.onchange=()=>{let e=Array.from(document.querySelectorAll("#lantaiFilter input:checked")).map(e=>e.value);saveSelectedFloors(e)},a.appendChild(n),a.append(" ",t),e.appendChild(a)})}function initResize(e){return function(t){let a=document.querySelectorAll("th")[e],n=t.pageX,r=a.offsetWidth;function l(e){let t=r+(e.pageX-n);a.style.width=t+"px"}function o(){document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",o)}document.addEventListener("mousemove",l),document.addEventListener("mouseup",o)}}function sortTable(e){currentSort.asc=currentSort.column!==e||!currentSort.asc,currentSort.column=e,data.sort((t,a)=>{let n=t[e]??"",r=a[e]??"";return currentSort.asc?n.toString().localeCompare(r.toString(),void 0,{numeric:!0}):r.toString().localeCompare(n.toString(),void 0,{numeric:!0})}),renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}function renderTable(){let e=document.getElementById("searchInput").value.toLowerCase(),t=getSelectedFloors(),a=["SKU","NAMA",...t,"Grand Total"],n=document.querySelector("#data-table thead"),r=document.querySelector("#data-table tbody");n.innerHTML="";let l=document.createElement("tr");a.forEach((e,t)=>{let a=document.createElement("th");a.textContent=e,a.onclick=()=>sortTable(e),currentSort.column===e&&a.classList.add(currentSort.asc?"sort-asc":"sort-desc");let n=document.createElement("div");n.classList.add("resizer"),n.addEventListener("mousedown",initResize(t)),a.appendChild(n),l.appendChild(a)}),n.appendChild(l);let o=data.filter(a=>{let n=`${a.SKU??""} ${a.NAMA??""}`.toLowerCase(),r=n.includes(e),l="minus"!==tab||t.some(e=>0>Number(a[e]))||0>Number(a["Grand Total"]);return r&&l}),s=document.createDocumentFragment(),d=o.slice(renderedRows,renderedRows+batchSize);d.forEach(e=>{let t=document.createElement("tr");a.forEach(a=>{let n=document.createElement("td"),r=e[a];(void 0===r||""===r)&&(r="-"),n.textContent=r,!isNaN(r)&&0>Number(r)&&n.classList.add("highlight-minus"),t.appendChild(n)}),s.appendChild(t)}),r.appendChild(s),renderedRows+=batchSize}function refreshTable(){renderedRows=0,document.querySelector("#data-table tbody").innerHTML="",renderTable()}function onSearchInput(){let e=document.getElementById("searchInput"),t=document.querySelector(".clear-button");""!==e.value.trim()?t.classList.add("show"):t.classList.remove("show"),refreshTable()}function clearSearch(){let e=document.getElementById("searchInput");e.value="",onSearchInput()}async function fetchData(){document.getElementById("spinner").style.display="inline-block";let[e,t]=await Promise.all([fetch("https://pernataan-db-default-rtdb.asia-southeast1.firebasedatabase.app/rekap.json"),fetch("https://pernataan-db-default-rtdb.asia-southeast1.firebasedatabase.app/sku_master.json")]),a=await e.json(),n=await t.json(),r=a||{};data=Object.values(n||{}).map(e=>({...e,...r[e.SKU]||{}})),setupLantaiCheckboxes(),document.querySelector("#data-table thead").innerHTML="",document.querySelector("#data-table tbody").innerHTML="",renderedRows=0,renderTable(),document.getElementById("lastUpdated").textContent=new Date().toLocaleTimeString("id-ID"),document.getElementById("spinner").style.display="none"}document.getElementById("tableWrapper").addEventListener("scroll",()=>{let e=document.getElementById("tableWrapper");e.scrollTop+e.clientHeight>=e.scrollHeight-10&&renderTable()}),document.getElementById("toggleFilterBtn").addEventListener("click",function(){let e=document.querySelector(".filter-wrapper"),t=document.getElementById("toggleFilterBtn"),a=e.classList.toggle("show");t.textContent=(a?"\uD83D\uDD3C":"\uD83D\uDD3D")+" Filter"}),loadSavedTheme(),fetchData(),setInterval(fetchData,6e4);